<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Cast Your Vote — Student Election</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/vote.css') }}">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<header class="navbar">
    <div class="nav-left">
        <span class="app-title">Student Election</span>
        <span class="app-subtitle">Blockchain-powered secure voting</span>
    </div>

    <div class="nav-right">
        <div class="status-pill" id="networkPill">Network: Not connected</div>
        <div class="status-pill secondary" id="walletStatus">Wallet: Not connected</div>
        <button id="connectWalletBtn" class="secondary-btn">Connect MetaMask</button>
    </div>
</header>

<main class="page-layout">

    <!-- LEFT: MAIN CARD -->
    <section class="main-card">
        <div class="main-card-header">
            <div>
                <h1>Cast Your Vote</h1>
                <p class="subtitle">Select one candidate and confirm using your wallet. Your vote is stored on-chain, not in any database.</p>
            </div>
            <div class="badge badge-open">Status: Live</div>
        </div>

        <form id="voteForm">
            <div class="candidates-grid">

                {% for c in candidates %}
                <label class="candidate-card">
                    <input type="radio" name="candidate" value="{{ c.id }}">
                    <div class="candidate-inner">
                        <div class="avatar-wrapper">
                            <img src="{{ url_for('static', filename='images/' + c.image) }}"
                                 class="cand-img"
                                 alt="{{ c.name }}">
                        </div>
                        <h3>{{ c.name }}</h3>
                        <p class="position">{{ c.position }}</p>
                        <div class="tags">
                            <span class="tag">CSE Dept</span>
                            <span class="tag">2nd Year</span>
                        </div>
                        <p class="hint">Click to select</p>
                    </div>
                </label>
                {% endfor %}

            </div>

            <div class="bottom-bar">
                <div class="message" id="status"></div>
                <div class="actions">
                    <button type="button" id="submitVoteBtn" class="primary-btn">
                        Confirm Vote on Blockchain
                    </button>
                    <a href="/dashboard" class="link-btn">Back to Dashboard</a>
                </div>
            </div>
        </form>
    </section>

    <!-- Compact info section under main card -->
    <section class="compact-info">
        <div class="info-grid">
            <div class="info-card">
                <h3>Selected</h3>
                <div id="selectedCandidateBox" class="selected-box empty">
                    <span>No candidate selected yet.</span>
                </div>
            </div>
            <div class="info-card">
                <h3>Wallet</h3>
                <p class="mono" id="walletAddressDisplay">—</p>
                <p id="voteStatusLabel" class="status-label">Not checked yet</p>
            </div>
            <div class="info-card">
                <h3>Transaction</h3>
                <p class="side-label small">Estimated gas fee</p>
                <p class="mono" id="gasFeeEstimate">—</p>
                <p class="side-label small">Last transaction hash</p>
                <p class="mono" id="txHashDisplay">—</p>
                <a class="link-btn" id="txHashLink" href="#" target="_blank" style="display:none;">View on Explorer</a>
            </div>
            <div class="info-card">
                <h3>Contract</h3>
                <p class="side-label small">Address override</p>
                <input id="contractAddressInput" class="mono" style="width:100%;" placeholder="0x...">
                <button type="button" id="saveContractAddressBtn" class="secondary-btn" style="margin-top:8px;">Save & Reload</button>
                <button type="button" id="openRemixBtn" class="secondary-btn" style="margin-top:8px;">Open Remix to Deploy</button>
            </div>
        </div>
    </section>

</main>

<!-- Vote animation overlay -->
<div id="voteAnimation" class="vote-animation hidden">
    <div class="vote-animation-inner">
        <div class="ballot-box">
            <div class="slot"></div>
            <div class="ballot"></div>
        </div>
        <p class="vote-text">Submitting your vote to the blockchain...</p>
    </div>
</div>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/ethers@6.10.0/dist/ethers.umd.min.js"></script>
<script src="{{ url_for('static', filename='jss/blockchainConfig.js') }}"></script>
<script src="{{ url_for('static', filename='jss/vote.js') }}"></script>

</body>
</html>
